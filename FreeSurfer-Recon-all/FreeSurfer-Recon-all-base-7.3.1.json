{
    "name": "FreeSurfer-Recon-all-BASE",
    "container-image": {
        "image": "docker.io/freesurfer/freesurfer:7.3.1",
        "type": "docker"
    },
    "tool-version": "7.3.1",
    "command-line": "export FS_LICENSE=$PWD/[LICENSE_FILE] && export SUBJECTS_DIR=$PWD && TP_BASE=$(tar -tf [TP_TARBALL] | awk -F/ '$2==\"\" && $1!=\"\" {printf \"-tp %s \", $1}' | sed 's/ $//') && tar -xzf [TP_TARBALL] && recon-all -base [BASE_ID] $TP_BASE [DIRECTIVES] [QCACHE] [MPRAGE] [3T] [CW256] [NOTAL-CHECK] [BRAINSTEM-STRUCTURES] [NO-WSGCAATLAS] [NO-SKULLSTRIP] && tar -czvf [RESULTS] [BASE_ID]",
    "suggested-resources": {
        "ram": 10240,
        "walltime-estimate": 960,
        "cpu-cores": 1
    },
	"author": "Laboratory for Computational Neuroimaging",
    "schema-version": "0.5",
    "output-files": [
        {
            "name": "Output",
            "optional": false,
            "id": "base_tarball",
            "path-template": "[BASE_ID].tar.gz",
            "value-key": "[RESULTS]"
        }
    ],
    "error-codes": [
        {
            "description": "Crashed",
            "code": 1
        }
    ],
    "inputs": [
        {
            "name": "License file",
            "value-key": "[LICENSE_FILE]",
            "optional": false,
            "description": "Valid license file needed to run FreeSurfer.",
            "id": "LICENSE_FILE",
            "type": "File"
        },
        {
            "name": "Output name",
            "optional": false,
            "value-key": "[BASE_ID]",
            "type": "String",
            "id": "BASE_ID",
            "description": "The patient ID without any timepoint suffix. This ID will be used to label the output directory and the resulting tarball containing the processed FreeSurfer longitudinal BASE template."
        },
        {
            "name": "Timepoints tarball",
            "id": "TP_TARBALL",
            "optional": false,
            "value-key": "[TP_TARBALL]",
            "type": "File",
            "description": "An input tarball containing the FreeSurfer-processed timepoint directories for the specified patient."
        },
        {
            "name": "Directive",
            "default-value": "-all",
            "value-key": "[DIRECTIVES]",
            "optional": false,
            "type": "String",
            "id": "directives",
            "value-choices": [
                "-all",
                "-autorecon1",
                "-autorecon2",
                "-autorecon2-cp",
                "-autorecon2-wm",
                "-autorecon2-inflate1",
                "-autorecon2-perhemi",
                "-autorecon3"
            ]
        },
        {
            "name": "qcache",
            "id": "qcache_flag",
            "optional": true,
            "value-key": "[QCACHE]",
            "description": "Produce the pre-cached files required by the Qdec utility, allowing rapid analysis of group data.",
            "command-line-flag": "-qcache",
            "type": "Flag"
        },
        {
            "name": "mprage",
            "id": "mprage_flag",
            "optional": true,
            "value-key": "[MPRAGE]",
            "description": "Assume scan parameters are MGH MP-RAGE protocol.",
            "command-line-flag": "-mprage",
            "type": "Flag"
        },
        {
            "name": "3T",
            "id": "3T_flag",
            "optional": true,
            "value-key": "[3T]",
            "description": "The -3T flag enables two specific options in recon-all for images acquired with a 3T scanner:  3T-specific NU intensity correction parameters are used in the Non-Uniform normalization stage, and the Schwartz 3T atlas is used for Talairach alignment",
            "command-line-flag": "-3T",
            "type": "Flag"
        },
        {
            "name": "cw256",
            "id": "cw256_flag",
            "optional": true,
            "value-key": "[CW256]",
            "description": "Include this flag after -autorecon1 if images have a FOV > 256.",
            "command-line-flag": "-cw256",
            "type": "Flag"
        },
        {
            "name": "Notal check",
            "id": "notal_flag",
            "optional": true,
            "value-key": "[NOTAL-CHECK]",
            "description": "Skip the automatic failure detection of Talairach alignment.",
            "command-line-flag": "-notal-check",
            "type": "Flag"
        },
        {
            "name": "Brainstem Structures",
            "id": "brainstem_structures_flag",
            "optional": true,
            "value-key": "[BRAINSTEM-STRUCTURES]",
            "description": "Segmentation of brainstem structures.",
            "command-line-flag": "-brainstem-structures",
            "type": "Flag"
        },
        {
            "name": "No wsgcaatlas",
            "id": "no_wsgcaatlas_flag",
            "optional": true,
            "value-key": "[NO-WSGCAATLAS]",
            "description": "Do not use GCA atlas when skull stripping.",
            "command-line-flag": "-no-wsgcaatlas",
            "type": "Flag"
        },
        {
            "name": "No skull strip",
            "id": "noskullstrip_flag",
            "optional": true,
            "value-key": "[NO-SKULLSTRIP]",
            "description": "Exclude skull strip step.",
            "command-line-flag": "-noskullstrip",
            "type": "Flag"
        }
    ],
    "custom": {
        "vip:directoryInputs":{"TP_TARBALL":{"patterns":["*.tgz","*.tar.gz"]}},
        "vip:dot": ["TP_TARBALL","BASE_ID"]
    },
    "description": "Runs the second step of FreeSurfer longitudinal processing pipeline (recon-all -base) by combining all available timepoints into a single unbiased subject-specific template/base."
}

